import{T as e,d as t,X as r,H as n,s as o}from"./core-DEFZLvIc.js";let i=0;const s=e=>`${e}-editor-${i++}`,a=new Map,c=new Map,l={worker:{codeBeforeRun:()=>o,onReady:({runAsync:e,io:t},{sync:r})=>{t.stdout=t.buffered(r.write),t.stderr=t.buffered(r.writeErr),r.revoke(),r.runAsync=e}}};async function u({currentTarget:e}){const{env:t,pySrc:o,outDiv:i}=this,s=!!e;if(s&&(e.disabled=!0,i.innerHTML=""),!a.has(t)){const e=URL.createObjectURL(new Blob([""])),o={type:this.interpreter},{config:i}=this;if(i){o.configURL=i;const{parse:e}=i.endsWith(".toml")?await import("./toml-CvAfdf9_.js"):JSON;o.config=e(await fetch(i).then((e=>e.text())));const{interpreter:t}=o.config;t&&(o.version=t)}const s=r.call(new n(null,l),e,o),{sync:c}=s,{promise:u,resolve:d}=Promise.withResolvers();a.set(t,u),c.revoke=()=>{URL.revokeObjectURL(e),d(s)}}a.get(t).then((t=>{t.onerror=({error:e})=>{s&&(i.innerHTML+=`<span style='color:red'>${e.message||e}</span>\n`),console.error(e)};const r=()=>{s&&(e.disabled=!1)},{sync:n}=t;n.write=e=>{s&&(i.innerText+=`${e}\n`)},n.writeErr=e=>{s&&(i.innerHTML+=`<span style='color:red'>${e}</span>\n`)},n.runAsync(o).then(r,r)}))}const d=(e,t)=>{const r=document.createElement("div");r.className=`${t}-editor-input`,r.setAttribute("aria-label","Python Script Area");const n=((e,t)=>{const r=document.createElement("button");return r.className=`absolute ${t}-editor-run-button`,r.innerHTML='<svg style="height:20px;width:20px;vertical-align:-.125em;transform-origin:center;overflow:visible;color:green" viewBox="0 0 384 512" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg"><g transform="translate(192 256)" transform-origin="96 0"><g transform="translate(0,0) scale(1,1)"><path d="M361 215C375.3 223.8 384 239.3 384 256C384 272.7 375.3 288.2 361 296.1L73.03 472.1C58.21 482 39.66 482.4 24.52 473.9C9.377 465.4 0 449.4 0 432V80C0 62.64 9.377 46.63 24.52 38.13C39.66 29.64 58.21 29.99 73.03 39.04L361 215z" fill="currentColor" transform="translate(-192 -256)"></path></g></g></svg>',r.setAttribute("aria-label","Python Script Run Button"),r.addEventListener("click",e),r})(e,t),o=document.createElement("div");return o.addEventListener("keydown",(e=>{e.stopPropagation()})),r.append(n,o),r},m=(e,t)=>{const r=document.createElement("div");r.className=`${t}-editor-box`;const n=d(e,t),o=(e=>{const t=document.createElement("div");return t.className=`${e}-editor-output`,t.id=`${s(e)}-output`,t})(t);return r.append(n,o),[r,o]},p=async(e,r,n)=>{const[{basicSetup:o,EditorView:i},{Compartment:a},{python:l},{indentUnit:d},{keymap:p},{defaultKeymap:f}]=await Promise.all([import("./codemirror-Dr2Hgejs.js"),import("./codemirror_state-BKbyfKsm.js"),import("./codemirror_lang-python-Cxoc-ydj.js"),import("./codemirror_language-_XiX6II0.js").then((function(e){return e.x})),import("./codemirror_view-C0PMO2z_.js").then((function(e){return e.q})),import("./codemirror_commands-MgxtVkrD.js")]),h=e.hasAttribute("setup"),g=e.hasAttribute("config"),v=`${n}-${e.getAttribute("env")||s(r)}`;if(g&&c.has(v))throw new SyntaxError(c.get(v)?`duplicated config for env: ${v}`:`unable to add a config to the env: ${v}`);c.set(v,g);const y=e.src?await fetch(e.src).then((e=>e.text())):e.textContent,b={interpreter:n,env:v,config:g&&new URL(e.getAttribute("config"),location.href).href,get pySrc(){return h?y:k.state.doc.toString()},get outDiv(){return h?null:A}};if(h)return void u.call(b,{currentTarget:null});const w=e.getAttribute("target");let $;if(w){if($=document.getElementById(w)||document.querySelector(w),!$)throw new Error(`Unknown target ${w}`)}else $=document.createElement(`${r}-editor`),$.style.display="block",e.after($);$.id||($.id=s(r)),$.hasAttribute("exec-id")||$.setAttribute("exec-id",0),$.hasAttribute("root")||$.setAttribute("root",$.id);const E=u.bind(b),[x,A]=m(E,r);x.dataset.env=e.hasAttribute("env")?v:n;const L=x.querySelector(`.${r}-editor-input > div`).attachShadow({mode:"open"});L.innerHTML="<style> :host { all: initial; }</style>",$.appendChild(x);const C=t(e.textContent).trim(),S=/^(\s+)/m.test(C)?RegExp.$1:"    ",k=new i({extensions:[d.of(S),(new a).of(l()),p.of([...f,{key:"Ctrl-Enter",run:E,preventDefault:!0},{key:"Cmd-Enter",run:E,preventDefault:!0},{key:"Shift-Enter",run:E,preventDefault:!0}]),o],parent:L,doc:C});k.focus()};let f=0,h=Promise.resolve();const g=()=>{f=0,v()},v=()=>{if(!f){f=setTimeout(g,250);for(const[t,r]of e){const e=`script[type="${t}-editor"]`;for(const n of document.querySelectorAll(e))n.type+="-active",h=h.then((()=>p(n,t,r)))}return h}};new MutationObserver(v).observe(document,{childList:!0,subtree:!0});var y=v();export{y as default};
//# sourceMappingURL=py-editor-CrcBapRX.js.map
